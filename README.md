# Практического задание python

## Задание

Необходимо написать очень простой поисковик по текстам документов. Данные хранятся в БД по желанию, поисковый индекс в эластике.
Ссылка на тестовый массива данных: ./posts.csv. 

__Структура БД:__

- `id` - уникальный для каждого документа;
- `rubrics` - массив рубрик;
- `text` - текст документа;
- `created_date` - дата создания документа.


__Структура Индекса:__

- `iD` - id из базы;
- `text` - текст из структуры БД.


__Необходимые методы:__

- сервис должен принимать на вход произвольный текстовый запрос, искать по тексту документа в индексе и возвращать первые 20 документов со всем полями БД, упорядоченные по дате создания;
- удалять документ из БД и индекса по полю  `id`.

__Технические требования:__

- любой python фреймворк кроме Django и DRF;
- `README` с гайдом по поднятию;
- `docs.json` - документация к сервису в формате openapi.

__Программа максимум:__

- функциональные тесты;
- сервис работает в Docker;
- асинхронные вызовы.

## Что сделано?

- [x] БД: SQLite
- [x] Индекс Elastic
- [x] API на Flask со всеми необходимыми методы
- [x] Документация к сервису в формате OpenAPI
- [x] Readme
- [x] Тесты
- [x] Сервис работает в Docker
- [x] Асинхронные вызовы

## О проекте

### Структура

```
.
|-- app
|   |-- __init__.py         - "Главный" модуль приложения
|   |-- elastic.py          - Функции для работы с Elasticsearch
|   |-- models.py           - Класс для работы с БД
|   |-- routes.py           - Модуль с обработкой запросов
|   |-- tasks.py            - Основная часть кода обработки запросов
|-- .gitignore
|-- Dockerfile
|-- README.md
|-- app.db                  - БД, созданная из .csv файла
|-- config.py               - Конфигурационный файл
|-- docs.json               - Документация в формате OpenAPI
|-- requirements.txt        - Зависимости
|-- server.py
|-- posts.csv           - Тестовые данные
```

### Методы API

Продублирую документацию к API в читаемом виде:

- `/search/?text=`:
    - Тип запроса: GET
    - Параметр: `text` - строка, которую нужно искать
    - Ответ: массив объектов Post:
    ```
    [
        {
            "id": int,
            "text": string,
            "created_date": string,
            "rubrics": [string, string, ...]
        },
        ...
    ]
    ```
- `/delete/?id=`:
    - Тип запроса: DELETE
    - Параметр: `id` - id поста 
    - Ответ: строка `True` или строка с ошибкой

## Как запускать?

Запустить сервис с помощью docker-compose up -d
Сервис стартует по адресу 127.0.0.1:5000.

PS. Для первого запуска Elasticsearch скачивается его image, чтобы он скачался нужно включить vpn! Первый запрос после запуска займет немного времени из-за создания индекса.